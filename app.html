<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MatchQuant Soccer Engine</title>

<style>
:root{
  --bg1:#0b1633;
  --bg2:#050814;
  --card:#0f1a3a;
  --accent:#58a6ff;
  --accent2:#2f81f7;
  --text:#ffffff;
  --muted:#9db4ff;
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:radial-gradient(circle at top,var(--bg1),var(--bg2));
  color:var(--text);
}
.container{max-width:900px;margin:auto;padding:16px}
.card{
  background:rgba(15,26,58,.92);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 10px 40px rgba(0,0,0,.4);
}
h1,h2{color:var(--accent);margin:0 0 12px}
label{display:block;margin-top:10px;color:var(--muted)}
input,select,button{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:14px;
  border:none;
  background:rgba(255,255,255,.08);
  color:white;
  font-size:16px;
}
button{
  background:linear-gradient(90deg,var(--accent2),var(--accent));
  font-weight:700;
  cursor:pointer;
}
.row{display:flex;justify-content:space-between;gap:12px;margin:8px 0}
.key{color:var(--muted);font-weight:700}
.val{font-weight:700;text-align:right}
.note{font-size:13px;color:#b6c8ff;margin-top:8px}
</style>
</head>

<body>
<div class="container">

<div class="card">
  <h1>MatchQuant</h1>
  <div class="note">Soccer Prediction Engine (xG-based)</div>
</div>

<div class="card">
  <h2>Mode 1 — Manual Match Input</h2>

  <label>League</label>
  <select id="league">
    <option value="EPL">EPL</option>
    <option value="LaLiga">LaLiga</option>
    <option value="SerieA">SerieA</option>
    <option value="Bundesliga">Bundesliga</option>
    <option value="Ligue1">Ligue1</option>
    <option value="Portugal">Portugal</option>
  </select>

  <button onclick="runAll()">Run ALL Leagues at Once</button>

  <label>Home Team</label>
  <input id="home" placeholder="Arsenal">

  <label>Away Team</label>
  <input id="away" placeholder="Aston Villa">

  <button onclick="runPrediction()">Run Prediction</button>
</div>

<div class="card">
  <h2>Result</h2>

  <div class="row"><div class="key">League:</div><div id="rLeague" class="val">—</div></div>
  <div class="row"><div class="key">Match:</div><div id="rMatch" class="val">—</div></div>
  <div class="row"><div class="key">xG Used:</div><div id="rXg" class="val">—</div></div>
  <div class="row"><div class="key">Predicted Score:</div><div id="rScore" class="val">—</div></div>
  <div class="row"><div class="key">O/U 2.5:</div><div id="rOU" class="val">—</div></div>
  <div class="row"><div class="key">Asian Handicap:</div><div id="rAH" class="val">—</div></div>
  <div class="row"><div class="key">Corners:</div><div id="rCorners" class="val">—</div></div>
  <div class="row"><div class="key">Cards:</div><div id="rCards" class="val">—</div></div>
  <div class="row"><div class="key">Win Probabilities:</div><div id="rProb" class="val">—</div></div>

  <div class="note" id="status">Loading xG tables…</div>
</div>

</div>

<script>
let XG=null;

fetch("xg_tables.json")
.then(r=>r.json())
.then(d=>{
  XG=d.leagues;
  document.getElementById("status").innerText =
    "xG tables loaded ✓ ("+Object.keys(XG).length+" leagues)";
});

function poisson(l,k){
  return Math.exp(-l)*Math.pow(l,k)/factorial(k);
}
function factorial(n){return n<=1?1:n*factorial(n-1);}

function runPrediction(){
  if(!XG) return;

  const lg=document.getElementById("league").value;
  const home=document.getElementById("home").value.trim();
  const away=document.getElementById("away").value.trim();
  if(!XG[lg]||!XG[lg][home]||!XG[lg][away]) return;

  const hx=XG[lg][home].xg_for;
  const ax=XG[lg][away].xg_for;

  let H=0,D=0,A=0;
  for(let i=0;i<=5;i++){
    for(let j=0;j<=5;j++){
      const p=poisson(hx,i)*poisson(ax,j);
      if(i>j)H+=p;
      else if(i<j)A+=p;
      else D+=p;
    }
  }

  const sum=H+D+A;
  H=Math.round(H/sum*100);
  D=Math.round(D/sum*100);
  A=100-H-D;

  const score=hx>ax?`${Math.round(hx)}-${Math.round(ax)}`:
               ax>hx?`${Math.round(ax)}-${Math.round(hx)}`:"1-1";

  document.getElementById("rLeague").innerText=lg;
  document.getElementById("rMatch").innerText=`${home} vs ${away}`;
  document.getElementById("rXg").innerText=`Home λ ${hx.toFixed(2)} / Away λ ${ax.toFixed(2)}`;
  document.getElementById("rScore").innerText=score;
  document.getElementById("rOU").innerText=(hx+ax>2.5)?"Over":"Under";
  document.getElementById("rAH").innerText=hx>ax?"Home -0.5":"0 (Draw No Bet lean)";
  document.getElementById("rCorners").innerText=(hx+ax>2.8)?"Over 8.5":"Under 9.5";
  document.getElementById("rCards").innerText=(hx+ax>2.6)?"Over 3.5":"Under 4.5";
  document.getElementById("rProb").innerText=`H ${H}% / D ${D}% / A ${A}%`;
}

function runAll(){
  alert("Multi-league batch runner will be added next.");
}
</script>
</body>
</html>
